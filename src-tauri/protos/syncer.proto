syntax = "proto3";
package syncer;

import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";

enum MessageType {
  CLIPBOARD = 0;
  GENERIC_TEXT = 1;
  CONNECTED_DEVICES = 2;
}

message ClipboardMessage { string content = 1; }

message DeviceInfo {
  string id = 1;
  string ip = 2;
  string name = 3;
  string platform = 4;
  bool connected = 5;
  int64 last_seen = 6;
}

message ConnectedDevices { repeated DeviceInfo devices = 1; }

message ClientMessage {
  string id = 1;
  int64 createdAt = 2;
  MessageType type = 3;

  oneof payload {
    ClipboardMessage clipboard = 4;
    GenericTextMessage genericText = 5;
    google.protobuf.Empty empty = 6;
  }
}

message ServerMessage {
  string id = 1;
  string senderId = 2;
  int64 createdAt = 3;
  MessageType type = 4;

  oneof payload {
    ClipboardMessage clipboard = 5;
    ConnectedDevices connectedDevices = 6;
    GenericTextMessage genericText = 7;
  }
}

message GenericTextMessage { string text = 1; }

service MessageService {
  rpc StreamMessages(google.protobuf.Empty) returns (stream ServerMessage);
  rpc SendMessage(stream ClientMessage) returns (google.protobuf.Empty);
  rpc IsReachable(google.protobuf.Empty) returns (google.protobuf.BoolValue);
}